{{- range (.Values.scenarios) }}
---
apiVersion: chaos-mesh.org/v1alpha1
kind: NetworkChaos
metadata:
  name: '{{ lower . }}-{{ $.Release.Name }}-{{ $.Release.Revision }}'
  namespace: {{ $.Release.Namespace }}
  annotations:
    experiment.chaos-mesh.org/pause: 'true'
  labels:
    scenario: '{{ . }}'
    release: '{{ $.Release.Name }}'
    revision: '{{ $.Release.Revision }}'
spec:
  scheduler:
    cron: '@every 30s'
  duration: '10s'
  action: loss
  direction: to
  externalTargets:
    - '{{ lower . }}-{{ $.Release.Name }}-{{ $.Release.Revision }}.servicebus.windows.net'
  mode: one
  selector:
    labelSelectors:
      testInstance: 'service-bus-{{ . }}-{{ $.Release.Name }}-{{ $.Release.Revision }}'
      chaos: 'true'
    namespaces:
      - {{ $.Release.Namespace }}
    podPhaseSelectors:
      - 'Running'
  loss:
    loss: '100'
    correlation: '100'
{{- end }}
